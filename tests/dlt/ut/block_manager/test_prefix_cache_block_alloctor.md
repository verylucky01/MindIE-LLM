| **测试套件**                          | **测试用例名称**                                                                 | **描述**                                                                 | **关键步骤**                                                                 | **预期结果**                                                                 |
|---------------------------------------|----------------------------------------------------------------------------------|--------------------------------------------------------------------------|-----------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| PrefixCacheBlockAlloctorTest          | should_return_one_blockObj_one_blockId_when_alloc_a_mutable_obj                  | 分配可变对象时应返回一个BlockObj和一个BlockId                             | 1. 初始化分配器（1组，7个Token）<br>2. 调用AllocateMutableBlock             | 1. BlockObj包含7个Token<br>2. 未填满<br>3. 占用1个Block                     |
| PrefixCacheBlockAlloctorTest          | should_return_blance_after_alloc_and_free_a_mutable_obj                         | 分配并释放可变对象后应恢复平衡                                           | 1. 分配并释放对象                                                           | 1. 占用0个Block<br>2. 空闲Block数量恢复为16                                   |
| PrefixCacheBlockAlloctorTest          | should_return_one_blockObj_one_blockId_when_alloc_a_imutable_obj                 | 分配不可变对象时应返回一个BlockObj和一个BlockId                           | 1. 初始化分配器（1组，8个Token）<br>2. 调用AllocateImmutableBlock           | 1. BlockObj填满<br>2. 标记为缓存但未计算                                     |
| PrefixCacheBlockAlloctorTest          | should_return_mark_computed_when_imutable_obj_touched                           | 不可变对象被访问后应标记为已计算                                         | 1. 分配不可变对象<br>2. 调用MarkBlocksAsComputed                             | 1. 计算标记从false变为true                                                   |
| PrefixCacheBlockAlloctorTest          | should_return_2_block_when_allocate_twice                                       | 两次分配应使用2个Block                                                   | 1. 分配两个不可变对象                                                       | 1. 占用2个Block                                                              |
| PrefixCacheBlockAlloctorTest          | should_return_8_block_when_allocate_group_size8                                 | 分配8组Token应使用8个Block                                                | 1. 调用AllocateImmutableBlocks分配8组Token                                    | 1. 返回8个BlockObj<br>2. 占用8个Block                                        |
| PrefixCacheBlockAlloctorTest          | should_return_reuse_1_use_9_block_when_reuse_no_touch                           | 重复分配应复用1个Block并新增9个                                           | 1. 分配8组后再次分配2次                                                    | 1. 空闲Block减少至7<br>2. 总占用10个Block                                    |
| PrefixCacheBlockAlloctorTest          | should_return_use_8_reuse_8_block_when_reuse_no_touch                           | 两次分配8组应复用8个Block                                                 | 1. 两次分配8组Token                                                        | 1. 总占用16个Block<br>2. 空闲Block保持8个                                     |
| PrefixCacheBlockAlloctorTest          | should_return_computed_false_when_allocate_2_same_block                         | 分配两个相同Block时计算标记应为false                                       | 1. 两次分配同一组Token                                                     | 1. 两个Block均未标记为已计算                                                 |
| PrefixCacheBlockAlloctorSwapTest      | should_return_swap_out_swap_in_mmutable_blocks                                  | 交换可变块后应正确迁移资源                                               | 1. 分配并交换可变块                                                         | 1. NPU分配器占用1个Block<br>2. CPU分配器空闲                                   |
| PrefixCacheBlockAlloctorSwapTest      | should_return_swap_out_swap_in_immutable_blocks                                 | 交换不可变块后应正确迁移资源                                             | 1. 分配并交换不可变块                                                       | 1. NPU分配器占用8个Block<br>2. CPU分配器无占用                               |
| FindCachedBlocksPrefixTest            | should_return_3_cached_prefix_block                                             | 查找3个缓存前缀应返回匹配结果                                             | 1. 分配并标记3个Block为计算完成<br>2. 传入3个Hash值                         | 1. 返回3个BlockId                                                           |
| FindCachedBlocksPrefixTest            | should_return_unmatched_cached_prefix_block                                     | 查找未缓存前缀应返回空结果                                                | 1. 传入3个不存在的Hash值                                                   | 1. 返回空列表                                                                |
| FindCachedBlocksPrefixTest            | should_return_8_cached_prefix_block                                             | 查找8个缓存前缀应返回完整匹配                                             | 1. 分配8个Block并标记为计算完成<br>2. 传入9个Hash值（前8个匹配）            | 1. 返回8个BlockId                                                           |
| FindCachedBlocksPrefixTest            | should_return_4_cached_prefix_block                                             | 查找4个缓存前缀应返回匹配结果                                             | 1. 分配4个Block并标记为计算完成<br>2. 传入8个Hash值（前4个匹配）            | 1. 返回4个BlockId                                                           |
| PrefixCacheEvictorTest                | should_return_evictor_saved_when_allocate_all_and_free                          | 分配并释放所有Block后应保存到Evictor                                       | 1. 分配并释放8个填满的Block                                                | 1. Evictor包含所有8个Block                                                   |
| PrefixCacheEvictorTest                | should_not_return_evictor_empty_when_allocate_all_and_free_unfull_block         | 分配并释放未填满的Block后Evictor应不保存                                   | 1. 分配并释放8个未填满的Block                                              | 1. Evictor不包含任何Block                                                   |
| PrefixCacheForkTest                   | should_return_full_block_chain_when_forking                                     | 复制完整链时应返回相同结构                                               | 1. 调用Fork复制完整8块链                                                   | 1. 返回8个Block<br>2. 链结构正确                                             |
| PrefixCacheForkTest                   | should_return_single_block_when_forking_single_block                             | 复制单块时应返回单个Block                                                | 1. 调用Fork复制单块                                                         | 1. 返回1个Block<br>2. 属性一致                                               |
| PrefixCacheForkTest                   | should_throw_runtime_error_when_forking_free_block                              | 复制已释放的Block应抛出异常                                               | 1. 模拟释放Block后调用Fork                                                  | 1. 抛出runtime_error                                                         |
| PrefixCacheForkTest                   | should_return_empty_vector_when_forking_null_block                              | 复制空指针应返回空列表                                                   | 1. 传入nullptr调用Fork                                                     | 1. 返回空列表                                                                |
| PrefixCacheForkTest                   | should_return_correct_chain_structure_when_forking_chain                        | 复制链时应保持正确前驱关系                                               | 1. 复制3块链                                                               | 1. 链结构正确（前块指向正确）                                               |
| PrefixCacheForkTest                   | should_increase_ref_count_when_forking_block                                    | 复制后引用计数应增加                                                     | 1. 调用Fork复制单块                                                         | 1. 引用计数从1变为2                                                         |
| PrefixCacheCommonBlockTest            | should_return_4_wehn_handle_different_sequence_lengths                         | 处理不同长度序列时应返回最长公共前缀                                       | 1. 传入3个长度不同的BlockId序列                                             | 1. 返回公共前缀长度4                                                         |
| PrefixCacheCommonBlockTest            | should_return_0_when_handle_empty_sequence                                      | 处理空输入时应返回空列表                                                 | 1. 传入空输入                                                             | 1. 返回空列表                                                               |
| PrefixCacheCommonBlockTest            | should_return_1_stop_at_first_mismatch                                          | 遇到第一个不匹配时应停止                                                 | 1. 传入包含不匹配元素的序列                                                 | 1. 返回第一个匹配元素                                                       |